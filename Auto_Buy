local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Players = game:GetService("Players")
local joueur = Players.LocalPlayer
local MonNomDePlot = joueur:GetAttribute("InPlot") -- recupérer le plot du joueur
local MonPlot = workspace.CoreObjects.Plots:FindFirstChild(MonNomDePlot) --transformation en format utilisable
local Bank = joueur.leaderstats.Cash:GetAttribute("ExactValue") --récupérer le cash du joueur et c'est un forma chiffres   
local ClientUtils = require(ReplicatedStorage:WaitForChild("Client"):WaitForChild("Modules"):WaitForChild("ClientUtils")) --avec ca on récupere pleins de choses importantes 
local rebirths = (ClientUtils.ProfileData and ClientUtils.ProfileData.leaderstats and ClientUtils.ProfileData.leaderstats.Rebirths) or 0
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Networker = ReplicatedStorage.Shared.Packages.Networker
local RaretesRecherchees = {
    --"GOD",
    "Event",
    "Divine",
    "Admin",
    "Exclusive",
}
local function GetConvoyeurInfo()
    wait(0.2)
    local EggFolder = workspace.CoreObjects.Eggs
    for _, model in ipairs(EggFolder:GetChildren()) do
        if model:GetAttribute("CurrentEgg") then
            for _, meshFolder in ipairs(model:GetChildren()) do
                if meshFolder.Name:match("^Meshes/") then
                    local billboard = meshFolder:FindFirstChild("BillboardAttachment")
                    if billboard then
                        local eggBillboard = billboard:FindFirstChild("EggBillboard")
                        if eggBillboard then
                            local EggFrame = eggBillboard:FindFirstChild("Frame")
                            if EggFrame then 
                                local Rarity = EggFrame:FindFirstChild("Rarity")
                                if Rarity and Rarity:IsA("TextLabel") then
                                    return Rarity.Text, model.Name
                                end
                            end
                        end
                    end
                end
            end
        end
    end
    return nil, nil
end
local function EstRareteRecherchee(rarete)
    for _, rareteRecherchee in ipairs(RaretesRecherchees) do
        if rarete == rareteRecherchee then
            return true
        end
    end
    return false
end
local function TrouverRareteAvecRetry(brainrotName, maxTentatives)
    maxTentatives = maxTentatives or 3 -- Par défaut 3 tentatives
    for tentative = 1, maxTentatives do
        local rarityText, _ = GetConvoyeurInfo()
        if rarityText then 
            return rarityText
        else
            if tentative < maxTentatives then
                wait(0.2) 
            end
        end
    end
    warn("⚠️ Impossible de trouver la rareté après", maxTentatives, "tentatives")
    return nil
end
local function AutoBuyEgg()
    while true do
        wait(0.3) 
        local rarityText, brainrotName = GetConvoyeurInfo()
        if brainrotName then
            if not rarityText then
                warn("no rarity found", brainrotName)
                rarityText = TrouverRareteAvecRetry(brainrotName, 3)
            end
            if rarityText then   
                if EstRareteRecherchee(rarityText) then
                    print(brainrotName, rarityText)
                    print(Bank)
                    Networker["RF/BuyEgg"]:InvokeServer(brainrotName, 1)
                    Networker["RF/BuyEgg"]:InvokeServer(brainrotName, 1)
                    Networker["RF/BuyEgg"]:InvokeServer(brainrotName, 1)
                    print(Bank)
                    Networker["RF/RequestEggSpawn"]:InvokeServer()
                    wait(0.2)
                else               
                    Networker["RF/RequestEggSpawn"]:InvokeServer()
                end
            else
                warn("no rarity mais le texte rarity a été trouvé ????", brainrotName)
                Networker["RF/RequestEggSpawn"]:InvokeServer()
            end
        else
            warn("meme pas de brainrot name ?? wtf")
            Networker["RF/RequestEggSpawn"]:InvokeServer()
        end
    end
end
AutoBuyEgg()